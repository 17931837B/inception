# Inception

## 概要 (Overview)
*このプロジェクトは、tobaba の 42カリキュラムの一部として作成されました*
このプロジェクトは、Docker を使用してシステム管理の知識を深めることを目的としています。
仮想マシン（VM）上で Docker Compose を使用し、**NGINX**, **WordPress**, **MariaDB** という3つの独立したサービスからなる小規模なインフラストラクチャを構築します。

既成の Docker イメージや自動構築ツールに頼らず、Dockerfile を自作することで、コンテナ化の仕組み、サービスのオーケストレーション、ネットワークの分離、およびデータの永続化について理解を深めます。

---

## ドキュメント構成 (Documentation)

詳細な使用方法や技術的な設計については、以下のドキュメントを参照してください。

* **[USER_DOC.md](./USER_DOC.md)**
    * セットアップ方法（`/etc/hosts` 設定）
    * 起動・停止コマンド (`make`)
    * ブラウザでのアクセス方法
    * 管理者ログイン情報

* **[DEV_DOC.md](./DEV_DOC.md)**
    * ネットワーク構成図
    * 各コンテナ（NGINX, WordPress, MariaDB）の詳細設定解説
    * データ永続化の仕組み
    * 開発者向けメンテナンス情報

---

## 技術的な比較 (Technical Comparisons)

本プロジェクトの課題要件に基づき、採用した技術と代替技術の比較を以下に示します。

### 1. 仮想マシン (VM) vs Docker (コンテナ)
* **仮想マシン (VM):**
    ハードウェア全体（CPU, メモリ, ディスクなど）を仮想化し、その上でゲスト OS を動かします。完全に隔離されますが、OS を丸ごと起動するためリソース消費が大きく、起動に時間がかかります。
* **Docker (コンテナ):**
    ホスト OS のカーネルを共有し、プロセスとしてアプリケーションを隔離実行します。OS 全体を含まないため非常に軽量で、数秒で起動します。
### 1. 仮想マシン (VM) vs Docker (コンテナ)



* **仮想マシン (VM):**
    ハードウェア全体（CPU, メモリ, ディスクなど）を仮想化し、その上でゲスト OS を動かします。VirtualBox上で動作し、完全に隔離されますが、OS を丸ごと起動するためリソース消費が大きく、起動に時間がかかります。
* **Docker (コンテナ):**
    ホスト OS のカーネルを共有し、プロセスとしてアプリケーションを隔離実行します。OS 全体を含まないため非常に軽量で、数秒で起動します。
* **本プロジェクトでの構成:**
    VM の *中* で Docker を動かす「インセプション（入れ子）」構成をとっています。

| 特徴 | 仮想マシン (Virtual Machine) | Docker コンテナ (Container) |
| :--- | :--- | :--- |
| **仮想化の対象** | ハードウェア | OS |
| **ゲストOS** | 完全なOSが必要（重い） | ホストOSのカーネルを共有（軽い） |
| **サイズ** | 数GB〜数十GB | 数MB〜数百MB |
| **起動速度** | 分単位（遅い） | 秒単位・ミリ秒単位（速い） |
| **隔離レベル** | 完全な隔離（高いセキュリティ） | プロセスレベルの隔離（軽量だが共有部分あり） |
| **移植性** | ハイパーバイザーに依存 | Docker Engineがあればどこでも動く |

### 2. Secrets vs 環境変数 (Environment Variables)
* **環境変数:**
    `.env` ファイルや `docker-compose.yml` にプレーンテキスト（平文）で値を設定します。手軽ですが、`docker inspect` コマンドなどで第三者が値を確認できてしまうリスクがあります。
* **Docker Secrets:**
    機密情報を暗号化して管理し、必要なコンテナにのみファイルとしてマウントする仕組みです。セキュリティ強度は高いですが、設定がやや複雑になります。
* **本プロジェクトでの採用:**
    課題の要件に従い、構成のシンプルさを優先して **環境変数 (.env)** を採用しています。ただし、`.env` ファイルは Git 管理外にするなど、最低限の漏洩対策を行っています。

| 特徴 | 環境変数 (Environment Variables) | Docker Secrets |
| :--- | :--- | :--- |
| **データの状態** | プレーンテキスト（平文） | 暗号化またはファイルマウント |
| **視認性** | `docker inspect` やログで見える | 必要なコンテナ内のみ閲覧可能 |
| **セキュリティ** | 低い（漏洩リスクあり） | 高い（推奨される管理方法） |
| **設定の複雑さ** | 簡単（`.env`ファイルなど） | やや複雑（Swarmモードなどが必要な場合も） |
| **主な用途** | 開発環境、非機密設定 | 本番環境、パスワード、APIキー |

### 3. Docker Network vs Host Network
* **Host Network:**
    コンテナがホストマシンの IP アドレスとポートを共有します。ネットワーク的な隔離がなく、ポート競合（例: ホストですでに 3306 を使っていると動かない）が発生しやすくなります。
* **Docker Network (Bridge):**
    Docker 内に仮想的なプライベートネットワークを作成します。コンテナには内部 IP が割り当てられ、コンテナ名（DNS）で相互通信が可能です。外部に公開したいポートだけを明示的に指定できます。
* **本プロジェクトでの採用:**
    カスタムブリッジネットワーク `inception_network` を作成しています。これにより、MariaDB を外部から隠蔽し、WordPress からのみアクセス可能にする安全な構成を実現しています。

| 特徴 | Host Network | Docker Network (Bridge) |
| :--- | :--- | :--- |
| **IPアドレス** | ホストマシンのIPを共有 | コンテナごとの内部IPを持つ |
| **ポート管理** | 競合しやすい（早い者勝ち） | マッピングで制御可能（競合しない） |
| **隔離性** | なし（ホストと同じレベル） | あり（独立したネットワーク空間） |
| **名前解決** | localhost / IP指定 | コンテナ名（サービス名）で通信可能 |
| **パフォーマンス** | 高い（オーバーヘッドなし） | わずかにNATのオーバーヘッドあり |

### 4. Docker Volumes vs Bind Mounts
* **Bind Mounts:**
    ホストマシンのファイルパス（例: `./data`）を直接コンテナにマウントします。場所が明確ですが、Docker の管理外であるため、移植性や権限管理に問題が出ることがあります。
* **Docker Volumes:**
    Docker が管理する保存領域（通常 `/var/lib/docker/volumes`）を使用します。安全ですが、データの物理的な場所をユーザーが直接操作するのは推奨されません。
* **本プロジェクトでの採用:**
    課題の「Bind Mount 禁止」かつ「ホストの特定パス (`/home/user/data`) に保存」という要件を満たすため、**Docker Named Volumes** を使用しつつ、ドライバオプション (`driver_opts`) で保存先をバインドする設定を採用しています。これにより、Docker の管理下にありながら、指定されたパスでのデータ永続化を実現しています。

| 特徴 | Bind Mounts | Docker Volumes |
| :--- | :--- | :--- |
| **保存場所** | ホスト上の任意のパス | Docker管理領域 (`/var/lib/docker/volumes`) |
| **管理主体** | ユーザー（OSのファイルシステム） | Docker CLI (`docker volume ...`) |
| **移植性** | 低い（ホストのパス構造に依存） | 高い（Docker環境間で移動容易） |
| **権限管理** | ホストのユーザー権限に依存 | Dockerが管理 |
| **主な用途** | 設定ファイル、ソースコード（開発時） | データベース、永続データ（本番時） |

---

## ディレクトリ構造 (Directory Structure)

```text
.
├── Makefile
├── README.md
├── USER_DOC.md
├── DEV_DOC.md
└── srcs
    ├── .env
    ├── docker-compose.yml
    └── mariadb
        │   ├── Dockerfile
        │   ├── conf/
        │   └── setting/
        ├── nginx
        │   ├── Dockerfile
        │   ├── conf/
        │   └── setting/
        └── wordpress
            ├── Dockerfile
            ├── conf/
            └── setting/
```